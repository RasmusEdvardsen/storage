{"remainingRequest":"/home/git/homestorage/homeweb/node_modules/babel-loader/lib/index.js!/home/git/homestorage/homeweb/node_modules/ts-loader/index.js??ref--13-2!/home/git/homestorage/homeweb/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/git/homestorage/homeweb/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/git/homestorage/homeweb/src/homestorage/components/previewWrapper.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/git/homestorage/homeweb/src/homestorage/components/previewWrapper.vue","mtime":1586434586906},{"path":"/home/git/homestorage/homeweb/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/git/homestorage/homeweb/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/git/homestorage/homeweb/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/home/git/homestorage/homeweb/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/git/homestorage/homeweb/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.reflect.construct\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.function.name\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/home/git/homestorage/homeweb/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/git/homestorage/homeweb/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/git/homestorage/homeweb/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _inherits from \"/home/git/homestorage/homeweb/node_modules/@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/git/homestorage/homeweb/node_modules/@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/git/homestorage/homeweb/node_modules/@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport { __decorate } from \"tslib\";\nimport Vue from \"vue\";\nimport { Component, Watch } from \"vue-property-decorator\";\nimport { Getter } from \"vuex-class\";\nimport downloadBlob from \"@/azure/downloadBlob\";\nimport { name as _name } from \"../utils/arrUtils\";\nimport { user } from \"../../auth/user\";\nvar namespace = \"homeStorage\";\n\nvar PreviewWrapper = /*#__PURE__*/function (_Vue) {\n  _inherits(PreviewWrapper, _Vue);\n\n  var _super = _createSuper(PreviewWrapper);\n\n  function PreviewWrapper() {\n    var _this;\n\n    _classCallCheck(this, PreviewWrapper);\n\n    _this = _super.apply(this, arguments);\n    _this.previewUrl = \"\";\n    _this.showPreview = true;\n    return _this;\n  }\n\n  _createClass(PreviewWrapper, [{\n    key: \"onActiveBlobChanged\",\n    value: function () {\n      var _onActiveBlobChanged = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(value) {\n        var _this2 = this;\n\n        var blobStorageUrl, namePath, src, options;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.previewUrl = \"\";\n\n                if (!(value === null)) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                this.showPreview = false;\n                _context.next = 6;\n                return this.$nextTick();\n\n              case 6:\n                this.showPreview = true;\n                blobStorageUrl = \"https://storageanarae.blob.core.windows.net/homestorage\";\n                namePath = \"/\" + value.name;\n                src = blobStorageUrl + namePath;\n                _context.next = 12;\n                return user.accessToken();\n\n              case 12:\n                _context.t0 = _context.sent;\n                _context.t1 = \"Bearer \" + _context.t0;\n                _context.t2 = {\n                  \"authorization\": _context.t1,\n                  \"x-ms-version\": \"2019-02-02\"\n                };\n                options = {\n                  headers: _context.t2\n                };\n                fetch(src, options).then(function (res) {\n                  return res.blob();\n                }).then(function (blob) {\n                  _this2.previewUrl = URL.createObjectURL(blob);\n                });\n\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function onActiveBlobChanged(_x) {\n        return _onActiveBlobChanged.apply(this, arguments);\n      }\n\n      return onActiveBlobChanged;\n    }() // put into util file\n\n  }, {\n    key: \"download\",\n    value: function () {\n      var _download = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(blob) {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (blob) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 2:\n                downloadBlob(\"homestorage\", blob.name, this.name(blob.name), true);\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function download(_x2) {\n        return _download.apply(this, arguments);\n      }\n\n      return download;\n    }()\n  }, {\n    key: \"name\",\n    value: function name(str) {\n      return _name(str);\n    }\n  }, {\n    key: \"activeBlobFileType\",\n    get: function get() {\n      if (this.activeBlob === null || !this.activeBlob.properties.contentType) {\n        return \"\";\n      }\n\n      var type = this.activeBlob.properties.contentType;\n\n      if (type.includes(\"image\")) {\n        return \"image\";\n      }\n\n      if (type.includes(\"video\")) {\n        return \"video\";\n      } else {\n        return \"\";\n      }\n    }\n  }]);\n\n  return PreviewWrapper;\n}(Vue);\n\n__decorate([Getter(\"activeBlob\", {\n  namespace: namespace\n})], PreviewWrapper.prototype, \"activeBlob\", void 0);\n\n__decorate([Watch(\"activeBlob\", {\n  deep: true\n})], PreviewWrapper.prototype, \"onActiveBlobChanged\", null);\n\nPreviewWrapper = __decorate([Component], PreviewWrapper);\nexport default PreviewWrapper;",{"version":3,"sources":["/home/git/homestorage/homeweb/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/git/homestorage/homeweb/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/git/homestorage/homeweb/src/homestorage/components/previewWrapper.vue?vue&type=script&lang=ts&"],"names":[],"mappings":"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","sourcesContent":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport { Component, Watch } from \"vue-property-decorator\";\r\nimport { Action, Getter } from \"vuex-class\";\r\n\r\nimport { BlobItem } from \"@azure/storage-blob/typings/src/generated/src/models\"; // src/generated/src/models\";\r\nimport downloadBlob from \"@/azure/downloadBlob\";\r\n\r\nimport { name } from \"../utils/arrUtils\";\r\nimport { post } from \"../../web/web\";\r\n\r\nimport { user } from \"../../auth/user\";\r\n\r\nconst namespace = \"homeStorage\";\r\n@Component\r\nexport default class PreviewWrapper extends Vue {\r\n  @Getter(\"activeBlob\", { namespace })\r\n  public activeBlob!: BlobItem;\r\n\r\n  public previewUrl: string = \"\";\r\n  public showPreview: boolean = true;\r\n\r\n  @Watch(\"activeBlob\", { deep: true })\r\n  public async onActiveBlobChanged(value: BlobItem | null) {\r\n    this.previewUrl = \"\";\r\n\r\n    if (value === null) {\r\n      return;\r\n    }\r\n\r\n    this.showPreview = false;\r\n    await this.$nextTick();\r\n    this.showPreview = true;\r\n\r\n    const blobStorageUrl =\r\n      \"https://storageanarae.blob.core.windows.net/homestorage\";\r\n    const namePath = \"/\" + value.name;\r\n\r\n    const src = blobStorageUrl + namePath;\r\n    const options = {\r\n      headers: {\r\n        \"authorization\": \"Bearer \" + (await user.accessToken()),\r\n        \"x-ms-version\": \"2019-02-02\",\r\n      },\r\n    };\r\n\r\n    fetch(src, options)\r\n      .then((res) => res.blob())\r\n      .then((blob) => {\r\n        this.previewUrl = URL.createObjectURL(blob);\r\n      });\r\n  }\r\n\r\n  // put into util file\r\n  get activeBlobFileType(): string {\r\n    if (this.activeBlob === null || !this.activeBlob.properties.contentType) {\r\n      return \"\";\r\n    }\r\n    const type: string = this.activeBlob.properties.contentType;\r\n    if (type.includes(\"image\")) {\r\n      return \"image\";\r\n    }\r\n    if (type.includes(\"video\")) {\r\n      return \"video\";\r\n    } else {\r\n      return \"\";\r\n    }\r\n  }\r\n\r\n  public async download(blob: BlobItem): Promise<void> {\r\n    if (!blob) {\r\n      return;\r\n    }\r\n\r\n    downloadBlob(\"homestorage\", blob.name, this.name(blob.name), true);\r\n  }\r\n\r\n  public name(str: string): string {\r\n    return name(str);\r\n  }\r\n}\r\n"],"sourceRoot":""}]}